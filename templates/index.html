<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>iPhone Tracker</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <button id="sidebar-toggle" aria-label="Toggle panel">&#9776;</button>
    <div id="sidebar-backdrop"></div>

    <div id="sidebar">
        <div class="sidebar-header">
            <h1>iPhone Tracker</h1>

            <!-- Mode Toggle -->
            <div class="mode-toggle">
                <button id="mode-datetime" class="mode-btn active">Date/Time</button>
                <button id="mode-live" class="mode-btn">Live</button>
            </div>
        </div>

        <!-- Live Mode Panel (hidden by default) -->
        <div id="live-panel" class="panel" style="display: none;">
            <div class="live-status">
                <span id="live-indicator" class="indicator-dot"></span>
                <span id="live-status-text">Stopped</span>
                <span id="live-last-update"></span>
            </div>

            <div class="live-session-start">
                <div class="session-label">SESSION START</div>
                <div id="live-start-time" class="session-time">--</div>
                <div id="live-duration" class="session-duration"></div>
            </div>

            <div class="live-info">
                <div>Points: <span id="live-total-points">0</span></div>
            </div>

            <!-- Live Tracking Stats (shown during animation and polling) -->
            <div id="live-tracking-info" class="live-tracking-stats" style="display: none;">
                <div class="session-label">TRACKING</div>
                <div class="stats-grid">
                    <span class="stat-label">Distance:</span>
                    <span class="stat-value" id="live-stat-distance">0.00 km</span>
                    <span class="stat-label">Duration:</span>
                    <span class="stat-value" id="live-stat-duration">0h 0m</span>
                    <span class="stat-label">Avg Speed:</span>
                    <span class="stat-value" id="live-stat-speed">0.0 km/h</span>
                    <span class="stat-label">Time:</span>
                    <span class="stat-value" id="live-stat-time">--:--:--</span>
                </div>
            </div>

            <div class="live-controls">
                <button id="live-start-btn" class="btn btn-success btn-full">Start Live Mode</button>
                <button id="live-reset-btn" class="btn btn-primary btn-full" style="display: none; margin-top: 8px;">Reset to Now</button>
            </div>

            <!-- Current Activity (prominent display) -->
            <div id="live-current-activity" class="live-current-activity" style="display: none;">
                <div class="session-label">CURRENT ACTIVITY</div>
                <div id="current-activity-content" class="current-activity-content"></div>
            </div>

            <!-- Past Activities (collapsible) -->
            <div id="live-activity-summary" style="margin-top: 12px; display: none;">
                <div class="session-label past-activities-header" onclick="togglePastActivities()" style="cursor: pointer;">
                    PAST ACTIVITIES <span id="past-activities-arrow">▼</span>
                </div>
                <div id="live-stats-content" class="live-stats-content"></div>
            </div>
        </div>

        <!-- Date & Time Selection (datetime mode) -->
        <div id="datetime-panel">
          <div class="panel">
            <h2>Date & Time Selection</h2>
            <div class="form-row">
                <label for="start-date">Start Date:</label>
                <input type="date" id="start-date">
            </div>
            <div class="form-row">
                <label for="end-date">End Date:</label>
                <input type="date" id="end-date">
            </div>
            <div class="form-row">
                <label for="start-time">Start Time:</label>
                <input type="time" id="start-time" value="00:00">
            </div>
            <div class="form-row">
                <label for="end-time">End Time:</label>
                <input type="time" id="end-time" value="23:59">
            </div>
            <div class="form-row">
                <label>Timezone:</label>
                <span id="timezone-display">Will be detected from GPS data</span>
            </div>
            <button id="detect-btn" class="btn btn-primary btn-full">Detect Activities</button>
          </div>

          <!-- Activity Summary -->
          <div id="activity-summary" class="panel">
              <h2>Activity Detection Results</h2>
              <div id="summary-content"></div>
          </div>

          <!-- Activity Controls -->
          <div id="activity-controls" class="panel">
              <h2>Activity Controls</h2>
              <label for="primary-activity">Start Tracking:</label>
              <select id="primary-activity" class="activity-select"></select>
              <button id="start-tracking-btn" class="btn btn-success btn-full" disabled>Start Tracking</button>

              <div style="margin-top:12px;">
                  <label>Add Layers:</label>
                  <div id="layer-checkboxes" class="layer-checkboxes"></div>
                  <button id="add-layers-btn" class="btn btn-primary" style="margin-top:6px;">Add Selected Layers</button>
              </div>
          </div>

          <!-- Tracking Info -->
          <div id="tracking-info" class="panel">
              <h2>Tracking Information</h2>
              <div class="stats-grid">
                  <span class="stat-label">Distance:</span>
                  <span class="stat-value" id="stat-distance">0.00 km</span>
                  <span class="stat-label">Duration:</span>
                  <span class="stat-value" id="stat-duration">0h 0m</span>
                  <span class="stat-label">Avg Speed:</span>
                  <span class="stat-value" id="stat-speed">0.0 km/h</span>
                  <span class="stat-label">Points:</span>
                  <span class="stat-value" id="stat-points">0</span>
                  <span class="stat-label">Time:</span>
                  <span class="stat-value" id="stat-time">--:--:--</span>
              </div>
              <div class="active-layers">
                  Active Layers: <span id="active-layers-text">None</span>
              </div>
              <div id="pause-status"></div>
              <button id="save-map-btn" class="btn btn-primary btn-full" style="margin-top:10px;" onclick="saveInteractiveMap()">Save Interactive Map</button>
              <div id="save-status"></div>
          </div>

          <!-- Activities Detail (datetime mode) -->
          <div id="datetime-activities" class="panel" style="display: none;">
              <div class="session-label datetime-activities-header" onclick="toggleDatetimeActivities()" style="cursor: pointer;">
                  ACTIVITIES <span id="datetime-activities-arrow">▼</span>
              </div>
              <div id="datetime-activities-content" class="live-stats-content"></div>
          </div>
        </div>
    </div>

    <div id="map-container">
        <div id="map"></div>
        <div id="playback-controls">
            <button id="step-back-btn" disabled>&#171; Back</button>
            <button id="pause-play-btn">Pause</button>
            <button id="step-forward-btn" disabled>Forward &#187;</button>
        </div>
    </div>

    <script src="/static/js/map.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>
</body>
</html>
